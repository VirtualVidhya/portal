---
export const prerender = false;
import type { Application } from "../../../scripts/types";

const { id } = Astro.params;
console.log("Dynamic route id:", id);

const pageUrl = new URL(
  `https://api.vvidhya.com/api/get-ind-application?id=${id}`,
  Astro.site
).toString();
console.log("Fetching from:", pageUrl);

// const response = await fetch(pageUrl);
// if (!response.ok) {
//   throw new Error("Application not found or an error occurred.");
// }
// const application: Application = await response.json();

let application: Application | null = null;
let errorMessage: string | null = null;

try {
  const response = await fetch(pageUrl);
  if (!response.ok) {
    throw new Error(`API Error: ${response.status} ${response.statusText}`);
  }
  application = await response.json();

  console.log("Received application data:", application);
} catch (error) {
  errorMessage = error instanceof Error ? error.message : "Unknown error";
  console.error("Error fetching application:", errorMessage);
}

import DashboardBaseLayout from "../../../layouts/DashboardBaseLayout.astro";
import LoadFilesForIndApp from "../../../components/LoadFilesForIndApp.astro";

const metadata = {
  title: "Individual Application Data - V.Vidhya",
  description: "View detailed individual application data",
};
---

<DashboardBaseLayout
  metadata={metadata}
  navSection="application-data"
  includeLottieAnimScript={false}
>
  <main class="flex flex-col items-center justify-center gap-3 w-full my-20">
    <section
      class="flex flex-col items-center justify-center gap-3 max-w-mdsm md:max-w-2xl lg:max-w-4xl 2xl:max-w-6xl"
    >
      <h2
        class="text-center text-font-color-sec text-[34px] md:text-5xl font-extrabold mb-10"
      >
        Individual Application Details
      </h2>

      {
        errorMessage ? (
          <p style="color: red;">{errorMessage}</p>
        ) : application ? (
          <div class="ind-app-data-container">
            <table class="ind-app-data-table">
              <tbody id="applications-table">
                <tr class="text-left">
                  <td colspan="2">
                    <img
                      src="/images/examples/passport-photo.png"
                      alt="Passport Photo"
                      class="w-18 h-18"
                    />
                  </td>
                </tr>
                <tr>
                  <td>Name</td>
                  <td>{application.full_name}</td>
                </tr>
                <tr>
                  <td>Age</td>
                  <td>{application.age}</td>
                </tr>
                <tr>
                  <td>DOB</td>
                  <td>{application.dob}</td>
                </tr>
                <tr>
                  <td>Gender</td>
                  <td>{application.gender}</td>
                </tr>
                <tr>
                  <td>Employment Status</td>
                  <td>{application.employment_status}</td>
                </tr>
                <tr>
                  <td>Occupation</td>
                  <td>{application.occupation}</td>
                </tr>

                <tr>
                  <td>Mobile Number</td>
                  <td>{application.contact_no}</td>
                </tr>
                <tr>
                  <td>Email</td>
                  <td>{application.email}</td>
                </tr>
                <tr>
                  <td>Emergency Contact Number</td>
                  <td>{application.parent_contact_no}</td>
                </tr>
                <tr>
                  <td>Current Address</td>
                  <td>{application.curr_address}</td>
                </tr>
                <tr>
                  <td>Permanent Address</td>
                  <td>{application.per_address}</td>
                </tr>

                <tr>
                  <td>Course</td>
                  <td>{application.course}</td>
                </tr>
                <tr>
                  <td>Academic Qualificaion</td>
                  <td>{application.academic_qual}</td>
                </tr>
                <tr>
                  <td>Skills Relevant to the course</td>
                  <td>{application.skills}</td>
                </tr>
                <tr>
                  <td>Previous Training related to the similar course </td>
                  <td>{application.previous_training}</td>
                </tr>

                <tr>
                  <td>How did you hear about us?</td>
                  <td>{application.reference}</td>
                </tr>

                <tr>
                  <td colspan="2">
                    <a
                      id="view-aadhar-card"
                      class="form-submit-btn"
                      type="button"
                      aria-label="View Aadhar Card"
                      href="/images/examples/aadhar-card.pdf"
                      download="/images/examples/aadhar-card.pdf"
                    >
                      Aadhar Card
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        ) : (
          <p>Loading application...</p>
        )
      }
    </section>
  </main>

  <slot name="specific-scripts-slot">
    <LoadFilesForIndApp />
  </slot>
</DashboardBaseLayout>
