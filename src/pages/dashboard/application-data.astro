---
export const prerender = false;
import DashboardBaseLayout from "../../layouts/DashboardBaseLayout.astro";
import type { Application } from "../../scripts/types";
import ApplicationsContainer from "../../components/ApplicationsContainer.jsx";

const metadata = {
  title: "Application Data - V.Vidhya",
  description: "View submitted applications securely.",
};

let applications: Application[] = [];
let errorMessage: string | null = null;

try {
  const res = await fetch("https://api.vvidhya.com/api/get-applications");
  if (!res.ok) {
    throw new Error(`API Error: ${res.status} ${res.statusText}`);
  }
  applications = await res.json();
  console.log("Fetched applications:", applications);
} catch (error) {
  errorMessage = error instanceof Error ? error.message : "Unknown error";
  console.error("Error fetching applications:", errorMessage);
}
---

<DashboardBaseLayout metadata={metadata} navSection="application-data">
  <main class="flex flex-col items-center justify-center gap-3 w-full my-20">
    <section
      class="flex flex-col items-center justify-center gap-3 max-w-mdsm md:max-w-2xl lg:max-w-4xl 2xl:max-w-6xl"
    >
      <h2
        class="text-center text-font-color-sec text-[34px] md:text-5xl font-extrabold mb-10"
      >
        Applications
      </h2>
      {
        errorMessage ? (
          <p style="color: red;">{errorMessage}</p>
        ) : (
          // Render the interactive DashboardApplications island
          <ApplicationsContainer
            initialApplications={applications}
            client:load
          />
        )
      }
    </section>
  </main>
</DashboardBaseLayout>
